# ЖОПА — Жутко Оптимизированный Персональный Ассистент

Голосовой ИИ-ассистент с характером Эндрю Тейта. Живёт в Arduino с LCD-дисплеем, слышит тебя через микрофон, отвечает живым голосом.

- **Arduino Uno** — LCD 16x2 с аниме-лицом (глаза + рот) + датчик расстояния HC-SR04
- **Python на ПК** — OpenAI Whisper (распознавание) + GPT-4o-mini (мозг) + TTS (голос)
- **Streaming** — ответ начинает звучать через 1-2 секунды, не ждёт полной генерации

---

## Как это выглядит

```
Ожидание:                 Слушает:                 Говорит:
┌────────────────┐        ┌────────────────┐        ┌────────────────┐
│  (o)(o)        │        │  (o)(o)        │        │  (o)(o)        │
│       :)       │        │     . . .      │        │       (O)      │
└────────────────┘        └────────────────┘        └────────────────┘

Сон:                      Подмигивание:             Удивление:
┌────────────────┐        ┌────────────────┐        ┌────────────────┐
│  ^_^    ^_^    │        │  (o)(o) ^_^    │        │  (O)(O)        │
│    z Z z       │        │       :)       │        │       (O)      │
└────────────────┘        └────────────────┘        └────────────────┘
```

Большие аниме-глаза моргают каждые 2-6 секунд и случайно смотрят по сторонам.

---

## Фичи

- **Streaming pipeline** — GPT генерирует ответ по предложениям → каждое сразу озвучивается
- **Beep-подтверждение** — короткий звук сразу после wake-word, чтобы ты знал что тебя услышали
- **Память** — ЖОПА помнит о чём говорили даже после ухода и возврата
- **Эмоции на дисплее** — удивление, злость, смех, подмигивание
- **Звуковые эффекты** — мелодии пробуждения и засыпания
- **Приветствие** — случайная фраза при подходе к датчику
- **Автопереподключение** — Serial восстанавливается при потере связи
- **Error handling** — при ошибках API говорит голосом, не крашится
- **Адаптивная тишина** — умно определяет конец фразы

---

## Активация

ЖОПА реагирует только на своё имя. Скажи **"ЖОПА"** + вопрос:

- "ЖОПА, как дела?"
- "ЖОПА, кто ты?"
- "ЖОПА, расскажи про Python"

---

## Железо

| Компонент | Описание |
|-----------|----------|
| Arduino Uno | Основная плата |
| LCD 16x2 + I2C модуль (PCF8574) | Дисплей с аниме-лицом |
| HC-SR04 | Датчик расстояния — автопробуждение |
| Микрофон | Подключён к ПК |
| Динамик / наушники | Подключены к ПК |
| USB кабель | Arduino ↔ ПК |

---

## Подключение

```
LCD I2C    Arduino Uno          HC-SR04    Arduino Uno
───────    ───────────          ───────    ───────────
VCC    →   5V                   VCC    →   5V
GND    →   GND                  GND    →   GND
SDA    →   A4                   TRIG   →   D7
SCL    →   A5                   ECHO   →   D6
```

---

## Установка

### 1. Arduino

1. Открой **Arduino IDE**
2. Установи библиотеку **LiquidCrystal I2C**: `Sketch → Include Library → Manage Libraries → "LiquidCrystal I2C"`
3. Открой `arduino/jarvis_mouth.ino`
4. Выбери `Tools → Board → Arduino Uno`, выбери порт
5. Нажми **Upload**

> Если дисплей пустой — покрути потенциометр на I2C модуле (контраст). Если не помогло — проверь I2C адрес (может быть 0x3F вместо 0x27).

### 2. Python

```bash
git clone https://github.com/Tanjiro00/Jarvis_arduino.git
cd Jarvis_arduino/python

# Linux — нужен portaudio для микрофона:
sudo apt install portaudio19-dev

pip install -r requirements.txt
```

### 3. API ключ

Создай файл `.env` в корне проекта (скопируй из `.env.example`):

```bash
cp .env.example .env
# Отредактируй .env — вставь свой ключ
```

Или задай переменную окружения:

```bash
export OPENAI_API_KEY="sk-proj-..."   # Linux / Mac
set OPENAI_API_KEY=sk-proj-...        # Windows CMD
```

Получить ключ: https://platform.openai.com/api-keys

---

## Запуск

### Текстовый режим (без микрофона)

```bash
cd python
python main.py
```

### Голосовой режим (микрофон + Arduino)

```bash
python main.py --voice              # Arduino определится автоматически
python main.py --voice COM9         # Windows — указать порт
python main.py --voice /dev/ttyUSB0 # Linux — указать порт
```

---

## Протокол Serial

Python → Arduino:

| Команда | Действие |
|---------|----------|
| `M0`-`M4` | Состояния рта (закрыт → широко открыт) |
| `L1` | Режим "слушаю" — пульсирующие точки |
| `A1` / `A0` | Начать / остановить анимацию разговора |
| `S1` / `S0` | Засыпание / пробуждение |
| `E1`-`E4` | Эмоции: удивление, злость, смех, подмигивание |
| `BL` | Быстрое моргание (подтверждение) |

Arduino → Python:

| Сообщение | Событие |
|-----------|---------|
| `WAKE` | Человек подошёл (< 80 см) |
| `SLEEP` | Человек ушёл (> 12 сек) |

---

## Структура проекта

```
Jarvis_arduino/
├── arduino/
│   └── jarvis_mouth.ino    # Arduino: LCD аниме-лицо + HC-SR04
├── python/
│   ├── main.py             # Главный скрипт (текстовый и голосовой)
│   ├── ai.py               # OpenAI GPT (streaming + память)
│   ├── speech.py           # Распознавание речи (OpenAI Whisper)
│   ├── tts.py              # Синтез речи (OpenAI TTS + звуковые эффекты)
│   ├── serial_comm.py      # Serial-связь с Arduino (автопереподключение)
│   ├── config.py           # Единая конфигурация
│   └── requirements.txt    # Зависимости
├── schemas/
│   └── wiring.md           # Схема подключения
├── .env.example            # Шаблон для API ключа
├── .gitignore
└── README.md
```

---

## Настройки

Все настройки в `python/config.py`:

```python
GPT_MODEL = "gpt-4o-mini"    # модель GPT
TTS_VOICE = "onyx"           # голос TTS (onyx, alloy, echo, nova, shimmer)
WAKE_DISTANCE_CM = 80        # порог датчика расстояния
MAX_HISTORY = 20             # длина контекста разговора
```

---

## Частые проблемы

**pyaudio не устанавливается:**
```bash
sudo apt install portaudio19-dev   # Ubuntu/Debian
brew install portaudio             # Mac
```

**Дисплей ничего не показывает:**
- Покрути потенциометр контрастности на I2C-модуле
- Проверь I2C адрес (запусти I2C Scanner — см. `schemas/wiring.md`)

**Arduino не определяется автоматически:**
```bash
python main.py --voice COM9           # Windows
python main.py --voice /dev/ttyUSB0   # Linux
```

**COM порт занят:**
- Закрой Arduino IDE / Serial Monitor перед запуском Python
